{% extends "base.html" %}



{% block title %} Feed {% endblock %}

{% block extra_head %}



  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.0/css/lightbox.min.css"  crossorigin="anonymous">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.0/js/lightbox.min.js" crossorigin="anonymous"></script>
  
  
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

  <link href="https://unpkg.com/blueprint-css@3.1.0/dist/blueprint.min.css" rel="stylesheet" />

  
  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
  <style>
    #PhotosModal div.modal-body {
      display: flex;
    }
    #PhotosModal div.modal-body img {
      max-height: 200px;
      max-width: 300px;
    }
    div.flex-right {
      display:flex; 
      flex-direction: row-reverse;
    }
    div.flex-right > div {
      margin: 0 5px;
    }
    div.flex-right > div:first-child {
      margin: 0 0px;
    }
    
    .popover {
      max-width: 576px;
    }
/*     footer img {width: 16px; height:16px} */
    div.user-popover img {width: 24px; height: 24px}
    div.table {display:table}
    div.row {display:table-row}
    div.cell {
        display:table-cell;
        border: 1px solid #999999;
        padding: 1px;}
    
    @media only screen and (min-width: 600px) {
      #main {
        padding: 0 10px;
      }
    } 
  </style>
  <script type="text/javascript" >
    $(function(){
        let searchParams = new URLSearchParams(window.location.search);
//         alert(searchParams.toString())
//         alert(searchParams.get('complaint'))
        if (searchParams.get('complaint') != null) {
//           alert(searchParams.get('complaint'))
          $('input:radio[name=complaint]').filter('[value='+searchParams.get('complaint')+']').prop('checked', true).parent().addClass('active');
        }
        $('input:radio[name=complaint]').change(function() {
          searchParams.set('complaint', this.value)
          window.location.search = searchParams.toString()
          
        })
        var prio = searchParams.get('priority');
        if ((prio == null) || (prio == 'any')) {
          $('#CurrPriority').html('Все события').addClass('text-secondary');
          $('#PriorityAny').remove();
        }
        if (prio == 'urgent') {
          $('#CurrPriority').html('Приоритетные инциденты').addClass('text-danger');
          $('#PriorityUrgent').remove();
        }
        if (prio == 'incident') {
          $('#CurrPriority').html('Все инциденты').addClass('text-warning');
          $('#PriorityIncident').remove();
        }
          
        $('#Priority a').click(function(){
          searchParams.set('priority', $(this).data('priority'))
          window.location.search = searchParams.toString()
        })
        
        lightbox.option({
          'resizeDuration': 200,
          'fitImagesInViewport': false,
//           'maxWidth': 10,
          'wrapAround': false
        })
        
        $('body').on('click', '#more', function(e){
          $.get('/feed_part/'+window.last_event+'/?'+searchParams.toString(), function(data){
//             alert(data);
            $('#feed').append(data);
          })
        })

        $('body').on('click', 'a.view-images', function(e){
          html = ''
          $(this).data('images').split(',').forEach(function(x, n){
//             
          html += `<div>
          <a href="https://s3.eu-central-1.amazonaws.com/ekc-uploads/`+x+`" data-lightbox="image-1" data-title="My caption"><img class="img-thumbnail" src="https://s3.eu-central-1.amazonaws.com/ekc-uploads/`+x+`"/></a>
            </div>`
          })
          $('#PhotosModal div.modal-body').html(html);
          $('#PhotosModalLongTitle').html($(this).data('title'));
          $('#PhotosModal').modal({})
        })
        
        $('[data-toggle="tooltip"]').tooltip()
//     $('[data-toggle="popover"]').popover()
//         function expandTextarea(id) {
        $('.select-complaint').select2({width: "resolve"});
        $('body').popover({
              content: function() {
                return $(this).closest('div').find('div.user-popover').show().get(0)
              },
              selector: 'a.user',
              trigger: 'click',
              html: true,
              closeOnClickOutside: true,  // https://github.com/twbs/bootstrap/issues/26719
        })
        $('body').on('click', 'a.subscribe', function(e) {
          if ($(this).text() == 'подписаться') {
            $(this).text('отписаться');
          } else {
            $(this).text('подписаться');
          }
          return false;
        })
        $('body').on('keyup', 'textarea', function(e) {
//             debugger;
            if ((e.originalEvent.code == 'Enter') && (e.originalEvent.shiftKey == false)) {
              $(this).val('');
              this.style.height = this.scrollHeight + 'px';
              return false;
            }
            this.style.overflow = 'hidden';
            this.style.height = 0;
            this.style.height = this.scrollHeight + 'px';
        });
//     }

//     expandTextarea('txtarea');

//         $("table").tablesorter();
        /*var options = {
            valueNames: [ 'app_id', ]
        };

        var hackerList = new List('my', options);*/
    });
  </script>
{% endblock %}

{% block main %}

<div id="main" >

  <div bp="grid" style="padding: 5px 0;">
    <div bp="4 text-left" class=''>
      {% include "_topleftmenu.html" %}
    </div>
<div bp="4 text-center">

      <span style="color:gray; margin-left: 10px"> Всего событий получено: {{num_events}} </span>
      
</div>
    <div bp="4 text-right" class=''>
      <a class='' style="color:gray;" href=#>Обсуждения <span class="badge badge-info">6</span></a>
    </div>
  </div>

  <div bp="grid" style="padding: 5px 0;">
    <div bp="4 text-center"></div>
    <div bp="4 text-center">
      <div class=''>
<!--         <div> -->
          <a class="dropdown-toggle" style="color:gray;" href="#" data-toggle="dropdown" aria-haspopup="true" id='CurrPriority'>Приоритетные инциденты
          </a>
          <div class="dropdown-menu" id='Priority'>
            <a id=PriorityUrgent class="dropdown-item text-danger" href="#" data-priority="urgent">Приоритетные инциденты</a>
            <a id=PriorityIncident class="dropdown-item text-warning" href="#" data-priority="incident">Все инциденты</a>
            <a id=PriorityAny class="dropdown-item text-secondary" href="#" data-priority="any">Все события</a>
          </div>
      </div>
      <!--<button type="button" class="btn btn-secondary btn-sm" data-toggle="modal" data-target="#exampleModalLong">
        Фильтр
      </button>-->
    </div>
  </div>
    
  <div bp="grid" style="padding: 5px 0;">
    <div bp="4 text-center"></div>
    <div bp="4 text-center">
        <div>Жалоба</div>
      <div class="btn-group btn-group-toggle" data-toggle="buttons">
        <label class="btn btn-light">
          <input type="radio" name="complaint" id="option1" value="0"> Нет
        </label>
        <label class="btn btn-light">
          <input type="radio" name="complaint" id="option2" value="any"> Неважно
        </label>
        <label class="btn btn-light">
          <input type="radio" name="complaint" id="option3" value="1"> Есть
        </label>
      </div>
    </div>
    <div bp="4 text-center"></div>
  </div>

  <div id='feed'>
    {% include "_feed.html" %}
    {% if not events %}
      <div style="text-align: center">
            Нет событий
      </div>
    {% endif %}
</div>
  

<div class="modal fade" id="ImagesModal" tabindex="-1" role="dialog" aria-labelledby="ImagesModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ImagesModalLongTitle">Фото</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <a href=#><img src="/static/Telegram_alternative_logo.png"/></a>
        <a href=#><img src="/static/mail-icon.png"/></a>
          
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}
