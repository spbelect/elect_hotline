{% extends "views/base.html" %}


{% block title %} {{_('Edit organization')}} {% endblock %}

{% block extra_head %}
  <script src="https://cdn.jsdelivr.net/npm/choices.js@11.0.2/public/assets/scripts/choices.min.js"></script>
{% endblock %}

{% block header %} {{_('Edit organization')}} {% endblock %}


{% block main %}

<form method=post x-data="{
    email: '',
    submit() {
        $ajax('', {method: 'post', target: 'errors', body: $el, sync: true})
      }
    }"
  class="flex max-w-md flex-col px-2 lg:px-4 border-opacity-50 mx-auto text-center" id='form'
  @ccchange="submit()"
  @ajax:success="location='/organizations'"
  @submit.prevent
>
  <input type=hidden name=id value="{{org.id}}" />

  <fieldset class="text-center align-middle mb-2">
    <input type=text class="input text-center input-bordered w-full" name=name placeholder="{{_('Name')}}"
    value="{{org.name}}"/>
  </fieldset>


  <fieldset class="text-center align-middle"
    @click="() => {
      // close choices dropdown on the second click
      //log()
      if($event.target.className.search(/choices__inner/g) >= 0)
        $refs.regions.choices.hideDropdown();
    }"
  >

    <select multiple
      x-ref="regions"
      x-init="$el.choices = new Choices(
        $el, {removeItemButton: true, classNames: {
          containerInner: ['choices__inner', '!text-center', '!pe-0', '!ps-0', '!bg-none'],
          input:  ['choices__input', '!text-center'],
        }}
      )"
      class="select hidden max-w-xs"
      name=regions

      @ccchange="query.region_id__in = $el.choices.getValue(true)"
    >
      <option placeholder>{{_('Regions')}}</option>
<!--           <option value="null">Регион: все</option> -->
      # set selected = org.regions.all()
      # for region in user.country.regions.all()
        <option value="{{region.id}}"
          # if org
          {{ 'selected' if region in selected else '' }}
          # endif
        >
          {{region.name}}
        </option>
      # endfor
    </select>

  </fieldset>

  <div class="mt-8 flex gap-2 justify-center">
    <button class="btn btn-primary"
      @click="$el.classList.add('animate-pulse', 'cursor-wait'); submit()"
    >
      {{_('Save') if org else _('Create')}}
    </button>
    <a class="btn" href="/organizations"
      @click="$el.classList.add('animate-pulse', 'cursor-wait');"
    >
      {{_('Cancel')}}
    </a>
  </div>
</form>

{% endblock %}
